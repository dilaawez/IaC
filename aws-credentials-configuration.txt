    A hands-on, practical lab tutorial series that walks you through each way Terraform authenticates to AWS, from your laptop to CI/CD and enterprise setups.

    Overview
    =========

    Youâ€™ll build and test AWS + Terraform authentication via:

    #	Method	                            Environment	        Level	            Practice goal
    --  ------                              -----------         -----               --------------
    1	Environment variables	            Local	            ðŸŸ¢ Beginner	        Quick test of Terraform â†’ AWS
    2	AWS shared credentials & profiles	Local	            ðŸŸ¢ Beginner	        Use multiple profiles
    3	Assume role (cross-account)	        Local	            ðŸŸ¡ Intermediate	    Role chaining via config
    4	AWS SSO (Identity Center)	        Local	            ðŸŸ¡ Intermediate	    Token-based login
    5	OIDC (GitLab/GitHub)	            CI/CD	            ðŸ”µ Advanced	        Passwordless CI
    6	Instance role (EC2/ECS)	            AWS-native	        ðŸ”µ Advanced	        No keys in code
    7	Credential process / Vault	        Enterprise	        ðŸŸ£ Expert	        External secrets engine


    Lab Prerequisites
    ------------------
    
    An AWS account (with permissions to create IAM users/roles, S3 buckets, EC2, etc.)
    Terraform â‰¥ v1.5 installed
    AWS CLI v2 installed
    (Optional) GitLab or GitHub access for OIDC labs


Lab 1 â€” Environment Variables (fastest setup)
==============================================

    Step 1: Export credentials

        export AWS_ACCESS_KEY_ID=YOUR_KEY
        export AWS_SECRET_ACCESS_KEY=YOUR_SECRET
        export AWS_DEFAULT_REGION=eu-central-1

    Step 2: Create a Terraform file

        main.tf

        provider "aws" {
            region = "eu-central-1"
        }

        resource "aws_s3_bucket" "test" {
            bucket_prefix = "tf-lab1-"
        }

    Step 3: Run

        terraform init
        terraform apply -auto-approve


    You authenticated with env vars.
    Check identity:

    aws sts get-caller-identity

 
 Lab 2 â€” AWS Profiles (~/.aws/credentials and ~/.aws/config)
 ============================================================

    Step 1: Configure profiles

        aws configure --profile dev
        aws configure --profile prod


    This creates:

        # ~/.aws/credentials
        [dev]
        aws_access_key_id = AKIADEV...
        aws_secret_access_key = SECRETDEV...

        [prod]
        aws_access_key_id = AKIAPROD...
        aws_secret_access_key = SECRETPROD...

    Step 2: Terraform with profiles

        main.tf

        provider "aws" {
            region  = "eu-central-1"
            profile = "dev"
        }

    Step 3: Run

        AWS_PROFILE=dev terraform plan          // Here AWS_PROFILE=dev will not work since provider already has profile="dev"


    You used named profiles instead of environment vars.


 Lab 3 â€” Assume Role (Cross-Account Access)
 ===========================================

    Step 1: In AWS console

    Create a role in another account:

        Trusted entity â†’ AWS account (your primary account)
        Note the role_arn

    Step 2: Update ~/.aws/config

        [profile main]
        region = eu-central-1
        aws_access_key_id = AKIAMAIN...
        aws_secret_access_key = SECRETMAIN...

        [profile cross]
        role_arn = arn:aws:iam::222222222222:role/TerraformRole
        source_profile = main
        region = eu-central-1

    Step 3: Terraform

        provider "aws" {
            profile = "cross"
            region  = "eu-central-1"
        }

    Step 4: Test

        aws sts get-caller-identity --profile cross


    Terraform now assumes a role across accounts.

 Lab 4 â€” AWS SSO (Identity Center)
 ==================================

    Step 1: Run SSO setup

        aws configure sso


    Itâ€™ll prompt for:

        SSO start URL
        SSO region
        Account ID
        Role name

    Step 2: Login

        aws sso login --profile my-sso

    Step 3: Terraform
        provider "aws" {
            profile = "my-sso"
            region  = "eu-central-1"
        }

    Step 4: Run

        terraform plan


    Terraform uses cached SSO tokens â€” no keys stored.

 
 Lab 5 â€” OIDC (GitLab or GitHub CI)
 ===================================

    Goal: Let your CI/CD pipeline authenticate without static keys.


    Step 1: Create an IAM OIDC provider

    In AWS:

        For GitHub, use issuer https://token.actions.githubusercontent.com
        For GitLab, use issuer https://gitlab.com

    Add trust policy to role:

        {
            "Effect": "Allow",
            "Principal": {
                "Federated": "arn:aws:iam::<ACCOUNT_ID>:oidc-provider/gitlab.com"
            },
            "Action": "sts:AssumeRoleWithWebIdentity",
            "Condition": {
                "StringEquals": {
                "gitlab.com:sub": "project_path:mygroup/myproject:ref_type:branch:ref:main"
                }
            }
        }


    Step 2: GitLab CI Example

    .gitlab-ci.yml

        deploy:
            image: hashicorp/terraform
            script:
                - terraform init
                - terraform apply -auto-approve
            variables:
                AWS_ROLE_ARN: "arn:aws:iam::<ACCOUNT_ID>:role/gitlab-oidc-role"
                AWS_REGION: "eu-central-1"
            id_tokens:
                AWS_OIDC_TOKEN:
                    aud: "https://gitlab.com"


    No secrets, no static credentials. Terraform assumes role automatically.

 
 Lab 6 â€” Instance Role (Running Terraform from EC2)
 ===================================================

    Step 1: Launch EC2 with IAM role

        Attach an IAM role allowing S3, EC2, etc.

    Step 2: SSH into EC2

        ssh ec2-user@<instance-ip>

    Step 3: Test credentials

        aws sts get-caller-identity


    Terraform auto-detects instance metadata:

        provider "aws" {
            region = "eu-central-1"
        }


    Terraform inherits EC2 instance role creds automatically â€” no config needed.

 
 Lab 7 â€” Credential Process (Vault or Custom Broker)
 ====================================================


    Step 1: Script that outputs credentials JSON

    /usr/local/bin/get-creds.sh

        #!/bin/bash
        cat <<EOF
        {
        "Version": 1,
        "AccessKeyId": "AKIAXXX",
        "SecretAccessKey": "SECRETXXX",
        "SessionToken": "TOKENXXX",
        "Expiration": "2025-12-31T23:59:59Z"
        }
        EOF


    Step 2: Update ~/.aws/config

        [profile vault]
        credential_process = /usr/local/bin/get-creds.sh
        region = eu-central-1


    Step 3: Terraform

        provider "aws" {
            profile = "vault"
            region  = "eu-central-1"
        }


    Terraform runs your external script to get credentials.


    Practice Summary Table
    -----------------------

    Lab	    Method	            Where it runs	    Secure?	        Key skills learned
    ---     -------             -------------       --------        --------------------
    1	    Env vars	        Local	            âŒ	           Basic provider config
    2	    Profiles	        Local	            âš ï¸	            Named profiles, config files
    3	    Assume role	        Local/Cross-account	âœ…	           Role chaining
    4	    SSO	                Local	            âœ…âœ…	         Identity Center tokens
    5	    OIDC	            CI/CD	            âœ…âœ…âœ…	        Passwordless CI
    6	    Instance Role	    AWS	                âœ…âœ…	         Metadata credentials
    7	    Credential Process	Enterprise	        âœ…âœ…âœ…	        Dynamic secret brokers


    Next Steps
    -----------
    
    To make this actionable, you can:

        Practice labs 1â€“3 on your laptop (no org setup needed).
        Then try 4 (SSO) if your org uses AWS Identity Center.
        If you have GitLab or GitHub CI access, try lab 5 â€” itâ€™s a real-world skill.
        For deeper security engineering, integrate Vault (lab 7).